import{F as e,I as t,N as n,P as r,f as i,g as a,h as o,j as s,k as c,m as l,p as u}from"./index-CRHk9dqo.js";var d=new WeakMap,f=(e,t,n,r=0,i=!1)=>{d.has(e)!==n&&(n?m(e,t,r,i):h(e,t))},p=e=>e===e.getRootNode().activeElement,m=(e,t,n,r=!1)=>{let i=t.parentNode,a=t.cloneNode(!1);a.classList.add(`cloned-input`),a.tabIndex=-1,r&&(a.disabled=!0),i.appendChild(a),d.set(e,a);let o=e.ownerDocument.dir===`rtl`?9999:-9999;e.style.pointerEvents=`none`,t.style.transform=`translate3d(${o}px,${n}px,0) scale(0)`},h=(e,t)=>{let n=d.get(e);n&&(d.delete(e),n.remove()),e.style.pointerEvents=``,t.style.transform=``},g=50,_=(e,t,n)=>{if(!n||!t)return()=>{};let i=n=>{p(t)&&f(e,t,n)},a=()=>f(e,t,!1),o=()=>i(!0),s=()=>i(!1);return c(n,`ionScrollStart`,o),c(n,`ionScrollEnd`,s),t.addEventListener(`blur`,a),()=>{r(n,`ionScrollStart`,o),r(n,`ionScrollEnd`,s),t.removeEventListener(`blur`,a)}},v=`input, textarea, [no-blur], [contenteditable]`,y=()=>{let e=!0,t=!1,n=document,i=()=>{t=!0},a=()=>{e=!0},o=r=>{if(t){t=!1;return}let i=n.activeElement;if(!i||i.matches(v))return;let a=r.target;a!==i&&(a.matches(v)||a.closest(v)||(e=!1,setTimeout(()=>{e||i.blur()},50)))};return c(n,`ionScrollStart`,i),n.addEventListener(`focusin`,a,!0),n.addEventListener(`touchend`,o,!1),()=>{r(n,`ionScrollStart`,i,!0),n.removeEventListener(`focusin`,a,!0),n.removeEventListener(`touchend`,o,!1)}},b=.3,x=(e,t,n,r)=>S((e.closest(`ion-item,[ion-item]`)??e).getBoundingClientRect(),t.getBoundingClientRect(),n,r),S=(e,t,n,r)=>{let i=e.top,a=e.bottom,o=t.top,s=Math.min(t.bottom,r-n),c=o+15,l=s-g-a,u=c-i,d=Math.round(l<0?-l:u>0?-u:0),f=Math.min(d,i-o),p=Math.abs(f)/b;return{scrollAmount:f,scrollDuration:Math.min(400,Math.max(150,p)),scrollPadding:n,inputSafeY:-(i-c)+4}},C=`$ionPaddingTimer`,w=(e,t,n)=>{let r=e[C];r&&clearTimeout(r),t>0?e.style.setProperty(`--keyboard-offset`,`${t}px`):e[C]=setTimeout(()=>{e.style.setProperty(`--keyboard-offset`,`0px`),n&&n()},120)},T=(e,t,n)=>{e.addEventListener(`focusout`,()=>{t&&w(t,0,n)},{once:!0})},E=0,D=`data-ionic-skip-scroll-assist`,O=(e,n,r,i,a,o,s,c=!1)=>{let l=o&&(s===void 0||s.mode===u.None),d=!1,f=t===void 0?0:t.innerHeight,p=t=>{if(d===!1){d=!0;return}A(e,n,r,i,t.detail.keyboardHeight,l,c,f,!1)},m=()=>{d=!1,t?.removeEventListener(`ionKeyboardDidShow`,p),e.removeEventListener(`focusout`,m)},h=async()=>{if(n.hasAttribute(D)){n.removeAttribute(D);return}A(e,n,r,i,a,l,c,f),t?.addEventListener(`ionKeyboardDidShow`,p),e.addEventListener(`focusout`,m)};return e.addEventListener(`focusin`,h),()=>{e.removeEventListener(`focusin`,h),t?.removeEventListener(`ionKeyboardDidShow`,p),e.removeEventListener(`focusout`,m)}},k=e=>{if(document.activeElement===e)return;let t=e.getAttribute(`id`),n=e.closest(`label[for="${t}"]`),r=document.activeElement?.closest(`label[for="${t}"]`);n!==null&&n===r||(e.setAttribute(D,`true`),e.focus())},A=async(e,t,r,i,s,c,l=!1,u=0,d=!0)=>{if(!r&&!i)return;let p=x(e,r||i,s,u);if(r&&Math.abs(p.scrollAmount)<4){k(t),c&&r!==null&&(w(r,E),T(t,r,()=>E=0));return}if(f(e,t,!0,p.inputSafeY,l),k(t),n(()=>e.click()),c&&r&&(E=p.scrollPadding,w(r,E)),typeof window<`u`){let n,i=async()=>{n!==void 0&&clearTimeout(n),window.removeEventListener(`ionKeyboardDidShow`,s),window.removeEventListener(`ionKeyboardDidShow`,i),r&&await a(r,0,p.scrollAmount,p.scrollDuration),f(e,t,!1,p.inputSafeY),k(t),c&&T(t,r,()=>E=0)},s=()=>{window.removeEventListener(`ionKeyboardDidShow`,s),window.addEventListener(`ionKeyboardDidShow`,i)};if(r){let e=await o(r),a=e.scrollHeight-e.clientHeight;if(d&&p.scrollAmount>a-e.scrollTop){t.type===`password`?(p.scrollAmount+=g,window.addEventListener(`ionKeyboardDidShow`,s)):window.addEventListener(`ionKeyboardDidShow`,i),n=setTimeout(i,1e3);return}}i()}},j=!0,M=async(t,n)=>{if(e===void 0)return;let r=n===`ios`,a=n===`android`,o=t.getNumber(`keyboardHeight`,290),c=t.getBoolean(`scrollAssist`,!0),u=t.getBoolean(`hideCaretOnScroll`,r),d=t.getBoolean(`inputBlurring`,!1),f=t.getBoolean(`scrollPadding`,!0),p=Array.from(e.querySelectorAll(`ion-input, ion-textarea`)),m=new WeakMap,h=new WeakMap,g=await i.getResizeMode(),v=async e=>{await new Promise(t=>s(e,t));let t=e.shadowRoot||e,n=t.querySelector(`input`)||t.querySelector(`textarea`),r=l(e),i=r?null:e.closest(`ion-footer`);if(n){if(r&&u&&!m.has(e)){let t=_(e,n,r);m.set(e,t)}if(!(n.type===`date`||n.type===`datetime-local`)&&(r||i)&&c&&!h.has(e)){let t=O(e,n,r,i,o,f,g,a);h.set(e,t)}}},b=e=>{if(u){let t=m.get(e);t&&t(),m.delete(e)}if(c){let t=h.get(e);t&&t(),h.delete(e)}};d&&j&&y();for(let e of p)v(e);e.addEventListener(`ionInputDidLoad`,e=>{v(e.detail)}),e.addEventListener(`ionInputDidUnload`,e=>{b(e.detail)})};export{M as startInputShims};